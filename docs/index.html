<html><head><meta charset="utf-8"><title>Hades Defence</title><script src="https://js13kgames.com/src/near-api-js.js" type="text/javascript"></script><style>body,html{height:100%;margin:0;padding:0}body{background-color:#262626;font-family:Papyrus,phantasy,sans-serif;display:grid;place-content:center}*{transition:all ease 1s}canvas{image-rendering:pixelated}.renderer{width:1056px;height:640px}</style></head><body><canvas id="game" width="528" height="320" class="renderer"></canvas><script>function aa(){var a=ba,b=da;return new Promise(c=>{const d=new Image;d.onload=()=>{b.forEach(e=>{a.g.set(e.n,{T:d,x:e.x,y:e.y,w:16,v:16})});c()};d.src="./hades.webp"})}function g(a,b,c,d){ba.g.set(a,{T:b,x:0,y:0,w:c,v:d})}function k(a){return ba.g.get(a)}class ea{constructor(){this.g=new Map}}const ba=new ea;const q=document.getElementById("game"),r=q.width,fa=q.height,t=q.getContext("2d");t.imageSmoothingEnabled=!1;function u(a,b,c,d=!1,e=!1,f=1){const h=k(a);h?d||e||1!==f?(t.save(),t.globalAlpha=f,t.translate(b+h.w/2,c+h.v/2),t.scale(d?-1:1,e?-1:1),t.drawImage(h.T,h.x,h.y,h.w,h.v,-h.w/2,-h.v/2,h.w,h.v),t.restore()):t.drawImage(h.T,h.x,h.y,h.w,h.v,b,c,h.w,h.v):console.warn(a,"not found")}
function v(a,b,c,d=16,e="#f0f0f0",f=!0,h="Papyrus"){t.font=`${d}px ${h}, fantasy, sans-serif`;t.textBaseline="middle";t.textAlign=f?"center":"left";t.fillStyle=e;t.fillText(a,b,c)};function ha(){t.fillStyle="rgb(56,56,56)";t.fillRect(0,0,r,fa);w(0,0,32,19,"brd1-b-")}function w(a,b,c,d,e){u(e+"i0",a,b);for(var f=0;f<c-1;f++)u(e+"i1",a+16*(f+1),b);u(e+"i2",a+16*c,b);for(f=0;f<d-1;f++)u(e+"i3",a,b+16*(f+1)),u(e+"i5",a+16*c,b+16*(f+1));u(e+"i6",a,b+16*d);for(f=0;f<c-1;f++)u(e+"i7",a+16*(f+1),b+16*d);u(e+"i8",a+16*c,b+16*d)};const ia=new Set;let x=void 0;q.addEventListener("mousemove",function(a){y=a.offsetX/2;B=a.offsetY/2});q.addEventListener("mouseup",function(){ja=!1});q.addEventListener("mousedown",function(){ja=!0});q.addEventListener("click",function(){x&&"function"===typeof x&&x()});document.addEventListener("keydown",a=>{ia.add(a.code)});document.addEventListener("keyup",a=>{ia.delete(a.code)});let y=0,B=0,ja=!1;function ka(a){for(let b=0,c=a.length;b<c;b++){const d=~~(Math.random()*c),e=a[b];a[b]=a[d];a[d]=e}}function la(a,b){try{return a.A.x===b.A.x?0:a.A.x>b.A.x?1:-1}catch(c){return 0}}function oa(a,b,c){return b.i.x===c.i.x?0:Math.abs(a-b.i.x)>Math.abs(a-c.i.x)?1:-1}const F=[[-3,0],[3,0],[-3,-5],[3,-5],[0,-10]];function pa(){const a=[];for(let b=0;4>b;b++){let c="w";0===b?c="c":3===b&&(c="f");a[b]=[];for(let d=0;31>d;d++)a[b][d]=[c,"x"].join("|")}return a};function qa(a){switch(a.mode){case 1:a.h=a.l.map((c,d)=>d);break;case 2:var b=a.l.map((c,d)=>d);a.h=[...b,[...b].reverse()];break;case 3:b=a.l.map((c,d)=>d),ka(b),a.h=b}}
class G{constructor(a,b,c,d=1,e=1){this.l=a;this.x=b;this.y=c;this.g=0;this.m=!0;this.h=[0];this.mode=e;this.B=d;qa(this);this.o=!1;this.alpha=1}j(a){1!==this.h.length&&this.m&&(this.g+=this.B*a,this.g>=this.h.length&&(this.g=0,3===this.mode&&qa(this)));0>=this.alpha||u(this.l[this.h[~~this.g]],~~this.x,~~this.y,this.o,void 0,this.alpha)}}function ra(a,b){a.h=b;a.g.forEach(c=>{c.A.o=b})}
class sa{constructor(){this.x=24;this.y=128;this.g=[];this.h=!1}j(a){this.g.forEach(b=>{this.h?(b.A.x=this.x-b.x,b.A.y=this.y-b.y):(b.A.x=this.x+b.x,b.A.y=this.y+b.y);b.A.j(a)})}};let I,ta;
I=(a=1,b=.05,c=220,d=0,e=0,f=.1,h=0,l=1,n=0,m=0,p=0,z=0,E=0,U=0,D=0,ca=0,J=0,Ea=1,ma=0,Xa=0)=>{let C=Math,H=2*C.PI,vb=n*=500*H/44100/44100,Ya=c*=(1-b+2*b*C.random(b=[]))*H/44100,V=0,wb=0,A=0,na=1,xb=0,yb=0,P=0,Fa,W;d=44100*d+9;ma*=44100;e*=44100;f*=44100;J*=44100;m*=500*H/44100**3;D*=H/44100;p*=H/44100;z*=44100;E=44100*E|0;for(W=d+ma+e+f+J|0;A<W;b[A++]=P)++yb%(100*ca|0)||(P=h?1<h?2<h?3<h?C.sin((V%H)**3):C.max(C.min(C.tan(V),1),-1):1-(2*V/H%2+2)%2:1-4*C.abs(C.round(V/H)-V/H):C.sin(V),P=(E?1-Xa+Xa*
C.sin(H*A/E):1)*(0<P?1:-1)*C.abs(P)**l*a*.3*(A<d?A/d:A<d+ma?1-(A-d)/ma*(1-Ea):A<d+ma+e?Ea:A<W-J?(W-A-J)/f*Ea:0),P=J?P/2+(J>A?0:(A<W-J?1:(W-A)/J)*b[A-J|0]/2):P),Fa=(c+=n+=m)*C.cos(D*wb++),V+=Fa-Fa*U*(1-1E9*(C.sin(A)+1)%2),na&&++na>z&&(c+=p,Ya+=p,na=0),!E||++xb%E||(c=Ya,n=vb,na=na||1);a=ta.createBuffer(1,W,44100);a.getChannelData(0).set(b);c=ta.createBufferSource();c.buffer=a;c.connect(ta.destination);c.start()};ta=new (window.AudioContext||webkitAudioContext);function K(){const a=window.localStorage.getItem("hades_sound");return!a||"true"===a}function ua(){window.localStorage.setItem("hades_sound",(!K()).toString())}function va(){K()&&I(...[.4,,71,.01,.07,.05,1,1.92,-7.9,-.7,,,,,,,.08,.98,.04])}function wa(){K()&&I(...[.2,,42,,.02,.05,3,.15,3.6,,,,,2,,,,.78,.08])}function xa(){K()&&I(...[.5,,521,.01,.01,.01,2,.75,12,34,-262,,,,,,,,.01,.05])};class L{constructor(a,b,c,d,e){this.text=a;this.x=b;this.y=c;this.width=d;this.g=!1;this.h=e}j(){var a=this.x-16*this.width/2;const b=this.y-16,c=16*this.width;(a=y>a&&y<a+c&&B>b&&B<b+32)?(ja&&!this.g&&(xa(),this.g=!0),!ja&&this.g&&(this.g=!1,this.h())):this.g=!1;w(this.x-16*this.width/2-8,this.y-24,this.width,2,a?"brd2-p-":"brd2-b-");v(this.text,this.x,this.y,17,"#f0f0f0")}}
class ya{constructor(a,b,c,d){this.text=a;this.A=new G([b],c-8,259);this.x=c;this.y=272;this.width=3;this.g=!1;this.h=d}j(a){var b=this.x-16*this.width/2;const c=this.y-16,d=16*this.width;(b=y>b&&y<b+d&&B>c&&B<c+32)?(ja&&!this.g&&(xa(),this.g=!0),!ja&&this.g&&(this.g=!1,this.h())):this.g=!1;t.strokeStyle=b||a?"#f00000":"#f0f0f0";t.beginPath();t.rect(this.x-16*this.width/2,this.y-16,16*this.width,32);t.stroke();this.A.j(0);v(this.text,this.x,this.y+8,10,"#f0f0f0",!0,"monospace")}};class za{constructor(a,b){this.x=a;this.y=b;this.g=new G(["lgth-c-i0","lgth-c-i1","lgth-c-i2"],a,b-3,10,3);this.h=new G("flm-c-i0 flm-c-i1 flm-c-i2 flm-c-i3 flm-c-i4 flm-c-i5".split(" "),a,b,10)}j(a){this.g.j(a);this.h.j(a)}};function Aa(a){a.target=a.x;a.h=a.F;var b=a.i;b.m=!1;b.g=0;a.o=!1}function M(a,b,c){0!==a.g?(a.l=!1,Aa(a)):(a.l=!0,a.target=b,a.h=c,a.o||(a.o=!0,a.i.m=!0))}function Ba(a,b){var c=8>Math.abs(a.x-80);c=0===a.g&&c;0>b&&c&&2>a.F&&(a.m=1,a.g=1);0<b&&c&&0<a.F&&(a.m=-1,a.g=1)}
class Ca{constructor(a,b,c,d=24){this.F=c;this.x=b;this.y=80*this.F+48;this.target=b;this.speed=d;a=this.i=new G(a,this.x,this.y,10);a.m=!1;a.g=0;this.l=!0;this.o=!1;this.h=c;this.g=this.m=0}j(a){1===this.g&&0<this.i.alpha?this.i.alpha-=3*a:1===this.g&&0>=this.i.alpha&&(this.i.alpha=0,this.F+=this.m,this.g=2);2===this.g&&1>this.i.alpha?this.i.alpha+=3*a:2===this.g&&1<=this.i.alpha&&(this.i.alpha=1,this.g=0);let b=this.target;void 0!==this.h&&this.F!==this.h&&(b=80,Ba(this,Math.sign(this.F-this.h)));
this.x!==this.target&&(this.i.o=this.x>b);this.l&&this.x>b&&(this.x-=a*this.speed);this.l&&this.x<b&&(this.x+=a*this.speed);this.y=80*this.F+48;this.i.x=this.x;this.i.y=this.y+1;2>Math.abs(this.x-this.target)&&Aa(this);this.i.j(a)}};class Da{constructor(a,b){this.B=a;this.o=this.B+32*Math.random()-16;this.l=b;this.h=10;this.A=new Ca(["sk-i1","sk-i2","sk-i0"],a,this.l,32);M(this.A,this.o);this.m=0;this.g=void 0}j(a){this.g&&(0>=this.g.R||this.g.i.F!==this.l)&&(this.g=void 0);this.m-=a;if(this.g){const b=6>Math.abs(this.A.x-this.g.i.x),c=0>=this.m;b&&c&&(this.g.R-=Ga,this.m=Ha);b?Aa(this.A):M(this.A,this.g.i.x)}else M(this.A,this.o);this.A.j(a);a=Math.max(0,this.h/10);1>a&&(t.fillStyle=.7<a?"#0f0":.3<a?"#ff0":"#f00",t.fillRect(this.A.i.x+
3,this.A.i.y,~~(10*a),1))}}function Ia(){var a=Ja;a.g=a.g.filter(b=>0<b.h)}class Ka{constructor(){this.g=[]}add(a,b){a=new Da(a,b);this.g.push(a);return a}}const Ja=new Ka;
class La{constructor(a,b,c,d){this.H=a;this.o=d;this.x=b;this.y=c;this.l=Math.round((this.y-48)/80);this.m=new G(["ob-i2"],b,c);this.g=[];this.h=[];this.D=1;this.S=!0}V(){return Number((this.H.I*Math.pow(1+(this.H.U??30)/100,this.D)).toFixed(1))}upgrade(a=!1){const b=this.V();N.g.C<b&&!a||(a||(N.g.C-=b,wa(),O(N)),this.D++,this.S=6>this.D)}j(a){this.m.j(a);for(var b=0;b<this.D-1;b++){var c=this.x+8+F[b][0],d=this.y+F[b][1];t.fillStyle="#f0f000";t.fillRect(c,d-1,1,3);t.fillRect(c-1,d,3,1)}if(!this.o){this.g.forEach(e=>
{e.j(a)});b=this.g.length;this.g=this.g.filter(e=>0<e.h);c=this.g.length;for(d=0;d<b-c;d++)this.h.push(50);b=Math.max(0,this.D-this.g.length-this.h.length);for(c=0;c<b;c++)d=Ja.add(this.x,this.l),this.g.push(d);for(b=0;b<this.h.length;b++)this.h[b]-=a;this.h=this.h.filter(e=>0<=e)}}};class Q{constructor(a,b,c){this.H=a;this.x=b;this.y=c;this.l=Math.round((this.y-48)/80);this.A=new G(["ob-i1-c"],b,c);this.h=this.g=10;this.D=1;this.S=!0}V(){return Number((this.H.I*Math.pow(1+(this.H.U??30)/100,this.D)).toFixed(1))}upgrade(a=!1){const b=this.V();N.g.C<b&&!a||(a||(N.g.C-=b,wa(),O(N)),this.D++,this.S=6>this.D,this.g+=8,this.h+=8)}j(a){this.A.j(a);for(a=0;a<this.D-1;a++){const b=this.x+8+F[a][0],c=this.y+F[a][1];t.fillStyle="#f0f000";t.fillRect(b,c-1,1,3);t.fillRect(b-1,c,3,1)}a=Math.max(0,
this.g/this.h);1>a&&(t.fillStyle=.7<a?"#0f0":.3<a?"#ff0":"#f00",t.fillRect(this.x+3,this.y+4,~~(10*a),1))}};let Ma=1;function Na(a,b,c){a.target=b;a.o=c}
function Oa(a,b){0>=a.R&&(a.g=4,Aa(a.i));const c=[N.o,N.m,N.B];a.time+=b;a.h-=b;const d=N.g.K.y===a.i.F&&8>Math.abs(N.g.K.x-a.i.x);let e=void 0,f=void 0;[...N.g.u.elysium.G,...N.g.u.asphodel.G,...N.g.u.tartar.G].forEach(l=>{!e&&l instanceof La&&l.l===a.i.F&&(e=l.g.find(({A:n,g:m})=>6>Math.abs(n.i.x-a.i.x)&&m?.id===a.id));!f&&l instanceof Q&&l.l===a.i.F&&l.x<a.i.x&&14>Math.abs(l.x-a.i.x)&&(f=l)});const [h]=[e,f].filter(Boolean).sort(la);4===a.g?a.i.i.alpha-=b:1===a.g?10>Math.abs(a.i.i.x-16*c[a.i.F])&&
(a.g=2):2===a.g?d||h?(h instanceof Da?Na(a,e.A.i.x,a.i.F):h instanceof Q&&Na(a,f.x,a.i.F),a.g=3,a.h=0,Aa(a.i)):Na(a,N.g.K.x,N.g.K.y):3===a.g&&(d||h?0>=a.h&&(a.h=a.J,h instanceof Da?e.h-=a.m:h instanceof Q?f.g-=a.m:N.g.O-=a.m):a.g=2)}
class Pa{constructor(){var a=512+20*Math.random(),b=.5<=Math.random()?0:2,c=18+10*Math.random();this.l=0===b;this.id=Ma++;this.B=this.R=this.l?Qa:Ra;this.h=this.time=0;this.J=this.l?Sa:Ta;this.m=this.l?Ua:Va;this.g=1;this.target=64;this.o=1;const d=this.l?"hr-c-i":"m-c-i";this.i=new Ca([d+"1",d+"2",d+"0"],a,b,c);Na(this,16*[N.o,N.m,N.B][this.i.F],b)}j(a){Oa(this,a);this.i.j(a);3!==this.g&&4!==this.g&&M(this.i,this.target,this.o);a=Math.max(0,this.R/this.B);1>a&&(t.fillStyle=.7<a?"#0f0":.3<a?"#ff0":
"#f00",t.fillRect(this.i.i.x+3,this.i.i.y,Math.max(1,~~(10*a)),1))}};function R(a,b){const c=document.createElement("canvas");c.width=a;c.height=b;a=c.getContext("2d");a.imageSmoothingEnabled=!1;return[c,a]}
function S(a,b,c,d,e=1){c=c.replaceAll(/[^\d,]/g,"").split(",").map(z=>+z);d=d?d.replaceAll(/[^\d,]/g,"").split(",").map(z=>+z):void 0;a=k(a);var f=a.T;const [h,l]=R(a.w,a.v);if(d){const [z,E,U]=d;l.fillStyle=`rgb(${z},${E},${U})`;l.fillRect(0,0,a.w,a.v)}const n=l.getImageData(0,0,a.w,a.v),m=n.data;var [,p]=R(a.w,a.v);p.drawImage(f,a.x,a.y,a.w,a.v,0,0,a.w,a.v);f=p.getImageData(0,0,a.w,a.v).data;for(p=0;p<f.length;p+=4)if(d){const z=f[p+3]/255;m[p]=z*f[p]/255*c[0]+(1-z)*m[p];m[p+1]=z*f[p]/255*c[1]+
(1-z)*m[p];m[p+2]=z*f[p]/255*c[2]+(1-z)*m[p];m[p+3]=255*e}else m[p]=f[p]/255*c[0],m[p+1]=f[p+1]/255*c[1],m[p+2]=f[p+2]/255*c[2],m[p+3]=f[p+3]*e;l.putImageData(n,0,0);g(b,h,a.w,a.v)}
function Wa(a,b,c=1){const d=[[255,0,0],[255,98,0],[255,191,0],[221,255,0],[128,255,0],[30,255,0],[0,255,64],[0,255,162],[0,255,255],[0,157,255],[0,64,255],[34,0,255],[127,0,255],[225,0,255],[255,0,191],[255,0,93]];a=k(a);var e=a.T;const [f,h]=R(a.w,a.v),l=h.getImageData(0,0,a.w,a.v),n=l.data;var [,m]=R(a.w,a.v);m.drawImage(e,a.x,a.y,a.w,a.v,0,0,a.w,a.v);e=m.getImageData(0,0,a.w,a.v).data;for(m=0;m<e.length;m+=4){const p=Math.floor(m/4/a.v);n[m]=e[m]/255*d[p][0];n[m+1]=e[m+1]/255*d[p][1];n[m+2]=e[m+
2]/255*d[p][2];n[m+3]=e[m+3]*c}h.putImageData(l,0,0);g(b,f,a.w,a.v)}function Za(a,b){a=k(a);const c=k("grad"),[d,e]=R(a.w,a.v);e.drawImage(a.T,a.x,a.y,a.w,a.v,0,0,a.w,a.v);e.save();e.globalCompositeOperation="destination-out";e.drawImage(c.T,c.x,c.y,c.w,c.v,0,0,c.w,c.v);e.restore();g(b,d,a.w,a.v)}function T(a,b,c,d){a=k(a);const e=a.w,f=a.v,[h,l]=R(a.w,a.v);l.translate(e/2,f/2);l.rotate(c);l.scale(1,b?-1:1);l.drawImage(a.T,a.x,a.y,a.w,a.v,-e/2,-f/2,a.w,a.v);g(d,h,a.w,a.v)}
function $a(a){a.strokeStyle="rgb(100,67,58)";a.beginPath();a.rect(0,0,25,25);a.stroke();a.strokeStyle="rgb(247,226,107)";a.beginPath();a.rect(1,1,23,23);a.stroke()}async function ab(a,b){try{const c=await (await fetch("https://api.arcadians.io/"+a)).json(),[d,e]=R(25,25),f=new Image;f.onload=()=>{e.drawImage(f,140,110,100,100,0,0,25,25);$a(e);g(b,d,25,25)};f.src=c.image}catch(c){console.warn("Failed to fetch arcadian id",a,c)}}
function bb(a,b){const [c,d]=R(25,25);d.fillStyle="rgb(38,50,50)";d.fillRect(0,0,25,25);$a(d);a=k(a);d.drawImage(a.T,a.x,a.y,a.w,a.v,4,4,a.w,a.v);g(b,c,25,25)};class cb{constructor(a,b,c,d,e=-1){this.H=a;this.x=b;this.y=c;this.g=e;a="arcadian"+e;if(!k(a)){var [f,h]=R(25,25);h.fillStyle="rgb(213,213,213)";h.fillRect(0,0,25,25);$a(h);h.font="20px Papyrus, fantasy, sans-serif";h.textBaseline="middle";h.textAlign="center";h.fillStyle="#303030";h.fillText("A",12,15);-1!==e&&ab(e,a);g(a,f,25,25)}this.A=new G(["arcadian"+e],b-5,c-5+(d?0:-15))}j(a){this.A.j(a)}};const db=window.nearApi?.keyStores?.BrowserLocalStorageKeyStore,eb={networkId:"testnet",keyStore:db?new db:void 0,nodeUrl:"https://rpc.testnet.near.org",walletUrl:"https://wallet.testnet.near.org",helperUrl:"https://helper.testnet.near.org",headers:{}};let fb,gb,hb,ib=!1;
async function jb(){try{fb=await window.nearApi.connect(eb),gb=new window.nearApi.WalletConnection(fb,null),hb=new window.nearApi.Contract(gb.account(),"hades-dev.vilpy.testnet",{viewMethods:["get_state"],changeMethods:["new","save_map","buy_premium"]}),ib=(await kb())?.premium_user??!1}catch(a){console.warn(a)}}async function lb(){try{mb()||await gb?.requestSignIn("hades-dev.vilpy.testnet","Hades Defence")}catch(a){console.warn(a)}}function mb(){return!!gb?.isSignedIn()}
async function kb(){if(mb())return hb.get_state({account_id:gb?.getAccountId()})}async function nb(a){if(mb())return hb.get_state({account_id:a})}async function ob(){let a=await kb();a||(a=await hb["new"]());pb(a)}async function qb(a){await hb.save_map({data:a})}async function rb(){await hb.buy_premium({},void 0,"500000000000000000000000")};function sb(a){return a?a instanceof cb?[a.H.id,a.x,a.y,a.g]:[a.H.id,a.x,a.y,a.D??0]:[]}function tb(a){const [b,c,d,e]=a;a=X.find(f=>f.id===b);if(!a)return null;if(a.ma)return ub(a,c,d,!1,e);a=ub(a,c,d,!1);if(a.S)for(let f=1;f<e;f++)a.upgrade(!0);return a}
function zb(a){return JSON.stringify({pp:{x:a.K.x,y:a.K.y},score:a.aa,ph:a.O,time:a.time,money:a.C,souls:a.W,mi:a.ca,tartar:{map:a.u.tartar.map,obj:a.u.tartar.G.map(sb)},asphodel:{map:a.u.asphodel.map,obj:a.u.asphodel.G.map(sb)},elysium:{map:a.u.elysium.map,obj:a.u.elysium.G.map(sb)}})}
function Ab(a,b){if(b)try{const c=JSON.parse(b);a.K.x=c.pp.x;a.K.y=c.pp.y;a.aa=c.score??0;a.O=c.ph??100;a.time=c.time??0;a.W=c.souls??0;a.C=c.money??10;a.ca=c.mi??0;a.u.tartar.map=c.tartar.map;a.u.tartar.G=c.tartar.obj.map(tb);a.u.asphodel.map=c.asphodel.map;a.u.asphodel.G=c.asphodel.obj.map(tb);a.u.elysium.map=c.elysium.map;a.u.elysium.G=c.elysium.obj.map(tb)}catch(c){console.warn("Tried to load broken state")}}
class Bb{constructor(){const a=pa(),b=pa(),c=pa();for(var d=0;4>d;d++)for(let e=0;10>e;e++)3===d?(b[d][e]="f|0|n",a[d][e]="f|0|n",c[d][e]="f|0|n"):(b[d][e]="w|0|n",a[d][e]="w|0|n",c[d][e]="w|0|n");for(d=10;31>d;d++)b[2][d]="w|0|n",a[2][d]="w|0|n";for(d=0;3>d;d++)c[3][d]="-";this.K={x:64,y:1};this.W=this.aa=0;this.O=100;this.time=0;this.C=ib?100:10;this.ca=0;this.u={tartar:{W:0,map:a,G:a[0].map(()=>null)},asphodel:{W:0,map:c,G:c[0].map(()=>null)},elysium:{W:0,map:b,G:c[0].map(()=>null)}}}da(){window.localStorage.setItem("hades_state",
zb(this))}ba(){const a=window.localStorage.getItem("hades_state");a&&Ab(this,a)}ja(){return qb(zb(this))}};function O(a){let b=0,c=0;[...a.g.u.elysium.G,...a.g.u.asphodel.G,...a.g.u.tartar.G].forEach(f=>{b+=f?.H?.value??0;c+=f?.H?.s??0});let d=0,e=0;[...a.g.u.elysium.map,...a.g.u.asphodel.map,...a.g.u.tartar.map].flat().forEach(f=>{const [h,l,n]=(f??"").split("|");if("x"!==l&&"-"!==h){f="w"===h?Cb[l]:Db[l];var m=n===Y?f.s:Math.max(f.s,.5);d+=(Eb[n]??0)*((n===Y?f.value:Math.max(f.value,.5))??0);e+=(Eb[n]??0)*(m??0)}});a.value=b+d;a.s=c+e;a.value-=Math.min(a.g.W*Fb,3E3);a.s-=Math.min(a.g.W*Gb,3E3);0>a.s?
(a.J=100/(1+Math.abs(a.s)/100*Hb),a.M=1+Math.abs(a.s)/100*Ib,a.L=2/(1+Math.abs(a.s)/100*Jb)):(a.J=100*(1+a.s/100*Hb),a.M=1/(1+a.s/100*Ib),a.L=2*(1+a.s/100*Jb))}function pb(a){var b=N;Ab(b.g,a.last_saved_map);O(b);Kb(b)}function Z(a,b){const c=a.g.u[b].map[0].findIndex(d=>"x"===d.split("|")[1]);return-1===c?a.g.u[b].map[0].length:c}function Lb(){var a=N;a.h=0;a.g=new Bb;a.B=Z(a,"tartar");a.m=Z(a,"asphodel");a.o=Z(a,"elysium");a.l=[];a.s=0;a.value=0;a.J=100;a.M=1;a.L=2}
function Kb(a){a.B=Z(a,"tartar");a.m=Z(a,"asphodel");a.o=Z(a,"elysium")}function Mb(a){a=Z(N,a);return Math.floor(2*Math.pow(1.2,a-10))}class Nb{constructor(){this.h=0;this.g=new Bb;this.B=Z(this,"tartar");this.m=Z(this,"asphodel");this.o=Z(this,"elysium");this.l=[];this.value=this.s=0;this.J=100;this.M=1;this.L=2}da(){this.g.da()}ba(){this.g.ba();O(this);Kb(this)}ja(){return this.g.ja()}}const N=new Nb;class Ob{constructor(){this.g=[]}add(a,b,c,d,e){this.g.push({xa:a,na:b,x:a,y:b,target:c,color:d,va:e,wa:Math.round((b-48)/80)})}j(a){this.g=this.g.filter(b=>{var c=b.target.i.x+8,d=b.target.i.y+8;const e=9>Math.pow(b.x-c,2)+Math.pow(b.y-d,2);t.fillStyle=b.color;t.fillRect(b.x-1,b.y-1,2,2);const f=Math.abs(b.x-c)/Math.abs(b.xa-c);b.x+=a*Math.sign(c-b.x)*64;b.y=b.na+(d-b.na)*(1-f);c=b.wa!==b.target.i.F;d=0>=b.target.R;e&&(b.target.R-=b.va);return!e&&!c&&!d})}}const Pb=new Ob;const Qb=[0,0,32,32,64,80],Rb=[1,2,2,3,3,5];function Sb(a,b){a.g-=b;const c=64+Qb[a.D-1];b=N.l.filter(d=>1!==d.g&&4!==d.g&&d.i.F===a.l&&Math.abs(d.i.x+8-a.x+8)<c);[b]=b.sort((d,e)=>oa(a.x,d,e));0>=a.g&&b&&(a.g=1/Rb[a.D-1],va(),Pb.add(a.x+7,a.y+2,b,"#fff000",2))}
class Tb{constructor(a,b,c){this.H=a;this.x=b;this.y=c;this.l=Math.round((this.y-48)/80);this.h=new G(["ob-i0-c"],b,c);this.m=new za(b-1,c-2);this.g=0;this.D=1;this.S=!0}V(){return Number((this.H.I*Math.pow(1+(this.H.U??30)/100,this.D)).toFixed(1))}upgrade(a=!1){const b=this.V();N.g.C<b&&!a||(a||(N.g.C-=b,wa(),O(N)),this.D=Math.min(this.D+1,6),this.S=6>this.D)}j(a){Sb(this,a);this.h.j(a);this.m.j(a);for(a=0;a<this.D-1;a++){const b=this.x+8+F[a][0],c=this.y+F[a][1];t.fillStyle="#f0f000";t.fillRect(b,
c-1,1,3);t.fillRect(b-1,c,3,1)}}};class Ub{constructor(a,b,c,d){this.H=a;this.x=b;this.y=c;this.g=new za(b,c+(d?0:-15))}j(a){this.g.j(a)}};class Vb{constructor(a,b,c,d){this.H=a;this.x=b;this.y=c;a=d?0:-32;this.h=new G(["lgth-c-i0","lgth-c-i1","lgth-c-i2"],b-1,c+a-5,10,3);this.g=new G(["lmp-c"],b-1,c+a+1)}j(a){this.h.j(a);this.g.j(a)}};class Wb{constructor(a,b,c,d,e){this.H=a;this.x=b;this.y=c;this.A=new G([e],b-5,c-5+(d?0:-15))}j(a){this.A.j(a)}};function Xb(a,b){Ja.g.forEach(c=>{c.l===a.g&&0<c.h&&10>c.h&&32>Math.abs(c.A.x-a.x)&&(c.h=Math.min(10,c.h+.1*b*a.D))});N.g.K.y===a.g&&32>Math.abs(N.g.K.x-a.x)&&(N.g.O=Math.min(N.J,N.g.O+b*a.D/2))}
class Yb{constructor(a,b,c){this.H=a;this.x=b;this.y=c;this.g=Math.round((this.y-48)/80);this.A=new G(["hpup-c"],b,c);this.D=1;this.S=!0}V(){return Number((this.H.I*Math.pow(1+(this.H.U??30)/100,this.D)).toFixed(1))}upgrade(a=!1){const b=this.V();N.g.C<b&&!a||(a||(N.g.C-=b,wa(),O(N)),this.D++,this.S=6>this.D)}j(a){Xb(this,a);this.A.j(a);for(a=0;a<this.D-1;a++){const b=this.x+8+F[a][0],c=this.y+F[a][1];t.fillStyle="#f0f000";t.fillRect(b,c-1,1,3);t.fillRect(b-1,c,3,1)}}};var Y="n",Cb=[{id:0,N:0,s:0,value:0},{id:1,N:.1,s:.5,value:.5},{id:2,N:.1,s:.5,value:.5},{id:3,N:.1,s:.5,value:.5}],Db=[{id:0,N:0,s:0,value:0},{id:1,N:.1,s:.5,value:.5},{id:2,N:.1,s:.5,value:.5},{id:3,N:.1,s:.5,value:.5}];
const X=[{id:0,name:"Defensive altar",description:"Launches fire charges into enemies\nEach upgrade increase either recharge rate or targeting distance",I:15,U:30,s:30,value:20,P:Tb},{id:1,name:"Barricade",description:"Can block enemies. Each upgrade increases durability\nCheap and sturdy",I:3,U:15,s:0,value:10,P:Q},{id:2,name:"Grave",description:"Spawns skeletons who can block and attack enemies\nEach upgrade adds skeleton and increases their health\nDestroyed skeletons respawn over time",I:12,U:10,
s:10,value:30,P:La},{id:9,name:"Potion station",description:"Automatically heals you and skeletons around",U:30,I:30,s:20,value:10,P:Yb},{id:4,name:"Wall light",description:"Improves overall mood and adds some value",I:5,s:30,value:5,P:Ub},{id:5,name:"Chandelier",description:"Improves overall mood and adds some value",I:15,s:10,value:80,P:Vb},{id:6,name:"Painting of an ordinary soul",description:"Improves overall mood and adds some value",I:10,s:40,value:40,P:Wb,ia:"soul-paint"},{id:7,name:"Painting of a skeleton",
description:"Improves overall mood and adds some value",I:20,s:80,value:50,P:Wb,ia:"sk-paint"},{id:8,name:"Painting of a you",description:"You look nice",I:30,s:150,value:100,P:Wb,ia:"hds-paint"},{id:900,ma:!0,name:"Arcadian NFT",description:"Improves overall mood and adds some value.\nID can be selected",I:10,s:40,value:40,P:cb}];function ub(a,b,c,d=!1,e){return new a.P(a,b,c,d,e||a.ia)};var Fb=.5,Gb=.45,Jb=.2,Ib=.3,Hb=.2,Eb={[Y]:1,d:2,l:3,g:4,h:5,s:6,p:7},Ha=2,Ga=2.7,Qa=10,Ua=2,Sa=2,Ra=15,Va=1.5,Ta=2;class Zb{constructor(a,b){var c=64+10*Math.random()-5,d=10*Math.random()+14;this.x=c;this.l=this.time=0;this.g=1;this.target=a;this.h=b;this.i=new Ca(["soul-base"],c,1,d);this.i.i.alpha=0}j(a){this.time+=a;this.l+=a;1===this.g?1>this.i.i.alpha?this.i.i.alpha+=a:this.g=2:3===this.g?3<this.l&&(this.g=2):4===this.g&&(this.i.i.alpha-=.2*a);2===this.g&&M(this.i,this.target,this.h);this.i.j(a);if(4!==this.g&&this.i.h===this.h&&10>Math.abs(this.target-this.i.x)){const b=[0,4,0],c=this.h;a=this.h;this.target=
16*(b[c]+Math.random()*([N.o,N.m,N.B][c]-b[c]));this.h=a;this.g=3;this.l=0}}}function $b(){const a=new Set;Ja.g.forEach(b=>{b.g&&a.add(b.g.id)});Ja.g.forEach(b=>{0<b.h&&(!b.g||0>=b.g.R)&&(b.g=N.l.find(c=>1!==c.g&&4!==c.g&&c.i.F===b.l&&64>Math.abs(c.i.x-b.B)&&!a.has(c.id)),b.g&&a.add(b.g.id))})}
function ac(a,b){a.time+=b;a.o+=b;a.g+=b;a.B+=b;10<a.B&&-1===a.h&&(a.h=1,ra(a.l,!1),a.g=0,a.B=0);if(1===a.h&&(a.l.x=Math.min(a.g,3)/3*48-10,3<a.g)){b=[N.o,N.m,N.B];var c=[0,4,0];a.g=0;const d=1+Math.round(1*N.value/100);K()&&I(...[.2,,905,.01,,.23,,1.11,,,,,,.1,-.1,,,.18,.01]);N.g.C+=d;a.h=2;for(let e=0;e<d;e++){N.g.aa++;N.g.W++;const f=Math.floor(3*Math.random());a.m.push(new Zb(16*(c[f]+Math.random()*(b[f]-c[f])),f))}b=Math.max(0,a.m.length-15);for(c=0;c<b;c++)a.m[c].g=4}2===a.h&&3<a.g&&(ra(a.l,
!0),a.g=0,a.h=3);3===a.h&&(a.l.x=(3-Math.min(a.g,3))/3*48-10,3<a.g&&(a.g=0,a.h=-1));if(0===N.l.length&&15<a.o)for(a.o=0,K()&&I(...[.7,,386,.06,.19,.35,2,1.56,4.1,-2.3,,,.14,,,,.01,.97,.1,.48]),a=Math.ceil(Math.pow(1.045,N.g.ca)),N.g.ca++,b=0;b<a;b++)c=new Pa,N.l.push(c);$b()}
class bc{constructor(){this.o=this.time=0;this.l=new sa;var a=new G(["chA"],0,0);this.l.g.push({A:a,x:-8,y:0});a=new G(["chB"],0,0);this.l.g.push({A:a,x:8,y:0});this.h=1;this.B=this.g=0;this.m=[]}j(a){ac(this,a);this.l.j(a);this.m=this.m.filter(c=>{c.j(a);return!(4===c.g&&0>=c.i.i.alpha)});const b=N.l.length;N.l=N.l.filter(c=>{c.j(a);(c=4===c.g&&0>=c.i.i.alpha)&&N.g.aa++;return!c});0===N.l.length&&0!==b&&(this.o=0)}};function cc(a,b){for(let c=0;c<b.length;c++){const d=b[c];for(let e=0;e<d.length;e++){const [f,h,l]=d[e].split("|");"-"!==f&&("x"===h?"f"===f?u("stones-grad",16+16*e,a+16*c):u("stones-d",16+16*e,a+16*c):("w"===f&&u("wl-i"+h+"-"+l,16+16*e,a+16*c),"f"===f&&u("flr-i"+h+"-"+l,16+16*e,a+16*c)))}}};const dc=[Y,"d","l","g","h","s","p"],ec=[0,30,100,250,400,700,0];function fc(a,b,c){const d=N.g.u[c].G;var e=X[a.h];e&&N.g.C>=e.I&&(N.g.C-=e.I,e=d[b],e instanceof La&&e.g.forEach(f=>f.h=-10),wa(),d[b]=ub(X[a.h],16*b+16,("tartar"===c?176:"asphodel"===c?96:16)+32,!1,a.$),O(N))}
function gc(a,b){ia.has("ArrowDown")&&Ba(a.g,-1);ia.has("ArrowUp")&&Ba(a.g,1);ia.has("ArrowLeft")?M(a.g,a.g.x-20):ia.has("ArrowRight")?M(a.g,a.g.x+20):Aa(a.g);a.g.x=Math.max(Math.min(a.g.x,[496,16*N.m,496][a.g.F]),[16,64,16][a.g.F]);N.g.K.x=a.g.x;N.g.K.y=a.g.F;N.g.O<N.J&&(N.g.O+=.1*b);0>=N.g.O&&(K()&&I(...[,,570,.05,.22,.3,,1.11,-5.5,,-75,.1,.07,,,,,.54,.16]),a.mode=6);var c=N.l.filter(d=>d.i.F===a.g.F&&4!==d.g?70>Math.abs(d.i.x-a.g.x+16):!1);[c]=c.sort((d,e)=>oa(a.g.i.x,d,e));a.Y-=b;c&&0>=a.Y&&(a.Y=
N.M,va(),Pb.add(a.g.i.x+8,a.g.i.y+8,c,"#f00000",N.L))}function hc(){cc(16,N.g.u.elysium.map);for(let a=0;31>a;a++)u("brick-b",16*a+16,80)}function ic(){cc(96,N.g.u.asphodel.map);for(var a=0;31>a;a++)u("brick-b",16*a+16,160);for(a=0;3>a;a++)u("water-c",16*a+16,144)}function jc(a){var b=Mb(a);if(N.g.C>=b){xa();N.g.C-=b;b=N;const c=Z(b,a);for(let d=0;4>d;d++)b.g.u[a].map[d][c]=3===d?"f|0|n":"w|0|n";Kb(b)}}function kc(){return 16<y&&512>y&&16<B&&80>B}function lc(){return 16<y&&512>y&&96<B&&160>B}
function mc(){return 16<y&&512>y&&176<B&&240>B}
function nc(a,b){a.B=-1;x=a.fa;w(0,0,32,19,"brd1-b-");a.ga.forEach((c,d)=>{const e=c.x,f=c.y;c.j(b);y>e-8&&y<e+30&&B>f-8&&B<f+30&&(a.B=d,t.strokeStyle="#f00000",t.beginPath(),t.rect(e-8,f-8,30,30),t.stroke());a.h===d&&(t.strokeStyle="#f0f000",t.beginPath(),t.rect(e-8,f-8,30,30),t.stroke())});a.cancel.j();if(-1!==a.B||-1!==a.h){const c=X[-1===a.B?a.h:a.B];v(c.name,32,70,18,"#fff0a0",!1);const d=c.description.split("\n");d.forEach((f,h)=>{v(f,32,90+20*h,16,"#f0f0f0",!1)});v("Base price: "+c.I,32,120+
20*d.length,16,"#f0f0f0",!1);c.U&&v("Upgrade costs multiplier: "+c.U+"%",32,140+20*d.length,16,"#f0f0f0",!1);let e=0;c.s&&(e=70,u("skull",32,150+20*d.length),v(0<c.s?"+"+c.s:c.s,48,160+20*d.length,16,"#f0f0f0",!1));c.value&&(u("crown-c",32+e,150+20*d.length),v(0<c.value?"+"+c.value:c.value,48+e,160+20*d.length,16,"#f0f0f0",!1));-1!==a.h&&a.ka.j()}else v("Pick object above",32,70,18,"#fff0a0",!1)}
function oc(a){a.l=-1;a.M=-1;a.X="";x=a.L;w(0,0,32,19,"brd1-b-");const b=ec.map(e=>N.g.aa>=e);v("Floor tiles",20,28,14,"#fff",!1);Db.forEach((e,f)=>{dc.forEach((h,l)=>{if(b[l]&&("p"!==h||ib)){var n=20+20*l,m=40+20*f;u("flr-i"+e.id+"-"+h,n,m);h="f"===a.m&&a.o===f&&a.J===l;var p=y>n&&y<n+16&&B>m&&B<m+16;p&&(a.l=f,a.M=l,a.X="f");if(h||p)t.strokeStyle="#f00000",t.beginPath(),t.rect(n-2,m-2,20,20),t.stroke()}})});v("Wall tiles",220,28,14,"#fff",!1);Cb.forEach((e,f)=>{dc.forEach((h,l)=>{if(b[l]&&("p"!==
h||ib)){var n=220+20*l,m=40+20*f;u("wl-i"+e.id+"-"+h,n,m);h="w"===a.m&&a.o===f&&a.J===l;var p=y>n&&y<n+16&&B>m&&B<m+16;p&&(a.l=f,a.M=l,a.X="w");if(h||p)t.strokeStyle="#f00000",t.beginPath(),t.rect(n-2,m-2,20,20),t.stroke()}})});if(-1!==a.o||-1!==a.l){let e=void 0;var c=-1===a.l?a.o:a.l,d=-1===a.l?a.m:a.X;const f=dc[-1===a.l?a.J:a.M];"f"===d?(e=Db[c],u("flr-i"+e.id+"-"+f,20,150)):"w"===d&&(e=Cb[c],u("wl-i"+e.id+"-"+f,20,150));u("money-c",20,170);u("skull",120,170);u("crown-c",220,170);c=f===Y?e.s:
Math.max(e.s,.5);d=f===Y?e.value:Math.max(e.value,.5);v("-"+((f===Y?e.N:Math.max(e.N,.1))*Eb[f]).toFixed(1),40,180,16,"#fff",!1);v("+"+(c*Eb[f]).toFixed(1),140,180,16,"#fff",!1);v("+"+(d*Eb[f]).toFixed(1),240,180,16,"#fff",!1)}else v("Pick object above",20,150,18,"#fff0a0",!1),v("Extra tiles will be opened later in the game",20,180,16,"#fff",!1);a.cancel.j();-1!==a.o&&a.ka.j()}
function pc(a){x=a.L;w(0,0,32,19,"brd1-b-");v("Game Over",r/2,60,40,"#b90000");for(let b=0;5>b;b++)u("skull",(b+3)*r/10,100);v("Your score",r/2,150,30,"#f0f0f0");v(0,r/2,180,20,"#f0f0f0");a.qa.j()}
class qc{constructor(){this.L=this.L.bind(this);this.fa=this.fa.bind(this);this.ea=this.ea.bind(this);this.J=this.o=-1;this.m="";this.M=this.l=-1;this.X="";this.h=this.B=-1;this.$=void 0;this.Z=0;this.oa=new bc;this.g=new Ca(["hds-i1","hds-i2","hds-i0"],N.g.K.x,N.g.K.y,30);this.mode=this.Y=0;this.sa=new G(["gate-c"],80,48);this.ra=new G(["gate-c"],80,128);this.ta=new G(["gate-c"],80,208);this.buttons=[new ya("Expand","expnd-c",145,()=>{this.mode=3}),new ya("Paint","pnt-c",200,()=>{this.mode=11}),
new ya("Build","bld-c",255,()=>{this.mode=21}),new ya("Upgrade","up-c",310,()=>{this.mode=4}),new ya("Menu","menu",365,()=>{this.mode=5})];this.ka=new L("Confirm",380,272,4,()=>{this.ea()});this.cancel=new L("Cancel",460,272,4,()=>{this.mode=0});this.ua=new L("Save",r/3,128,8,()=>{N.da();this.mode=0});this.ha=new L("Save to Near",2*r/3,128,8,async()=>{this.ha.text="Saving...";N.da();await N.ja();this.mode=0;this.ha.text="Save to Near"});this.la=new L("Sound ("+(K()?"On":"Off")+")",r/3,192,8,()=>{ua();
this.la.text="Sound ("+(K()?"On":"Off")+")"});this.pa=new L("Exit to Main",2*r/3,192,8,()=>{N.h=0});this.qa=new L("Exit to Main menu",r/2,272,10,()=>{N.h=0});this.ga=X.map((a,b)=>ub(a,30+40*b,30,!0));Ja.g=[]}ea(){11===this.mode?this.mode=10:21===this.mode&&(this.mode=20)}L(){-1!==this.l&&(this.o=this.l,this.J=this.M,this.m=this.X)}fa(){if(-1!==this.B){this.h=this.B;const b=X[this.h];if(b.ma){var a=window.prompt("Enter Arcadian NFT id (1 ~ 3732)")||"-1";this.$=parseInt(a,10);a=this.ga[this.h];this.ga[this.h]=
ub(b,a.x,a.y,!0,this.$)}else this.$=void 0}}j(a){0>=this.Z&&(O(N),this.Z=1);this.Z-=a;Ia();t.clearRect(0,0,r,fa);x=void 0;if(11===this.mode)oc(this);else if(21===this.mode)nc(this,a);else if(5===this.mode)x=this.L,w(0,0,32,19,"brd1-b-"),v("Hades Defence",r/2,40,25,"#f0f0f0"),v("Score",r/2,65,20,"#f0f0f0"),v(N.g.aa,r/2,85,20,"#f0f0f0"),this.ua.j(),mb()&&this.ha.j(),this.la.j(),this.pa.j(),this.cancel.j();else if(6===this.mode)pc(this);else{gc(this,a);cc(176,N.g.u.tartar.map);ic();hc();this.sa.j(a);
this.ra.j(a);this.ta.j(a);N.g.u.tartar.G.forEach((l,n)=>{l?.j(a);l instanceof Q&&0>=l.g&&(N.g.u.tartar.G[n]=void 0)});N.g.u.asphodel.G.forEach((l,n)=>{l?.j(a);l instanceof Q&&0>=l.g&&(N.g.u.asphodel.G[n]=void 0)});N.g.u.elysium.G.forEach((l,n)=>{l?.j(a);l instanceof Q&&0>=l.g&&(N.g.u.elysium.G[n]=void 0)});this.g.j(a);this.oa.j(a);Pb.j(a);w(0,0,32,19,"brd1-b-");w(16,240,30,3,"brd2-b-");var b=1E5<N.g.C?"99999+":N.g.C.toFixed(1);u("money-c",24,251);v(b,42,262,16,"#fff",!1);u("hp-c",24,277);v(Math.ceil(N.g.O),
42,287,16,"#fff",!1);u("crown-c",395,251);v("Value: "+Math.round(N.value)+"%",414,262,14,"#fff",!1);u("skull",395,277);v("Mood: "+Math.round(N.s)+"%",414,287,14,"#fff",!1);var c=[3===this.mode,10===this.mode,20===this.mode,4===this.mode];this.buttons.forEach((l,n)=>l.j(c[n]));b=N.B;var d=N.m,e=N.o;if(3===this.mode){var f=0,h=0;mc()&&31>b?(x=()=>jc("tartar"),f=176,h=16*(b+1),v(`-${Mb("tartar")}$`,y,B-14,16)):lc()&&31>d?(x=()=>jc("asphodel"),f=96,h=16*(d+1),v(`-${Mb("asphodel")}$`,y,B-14,16)):kc()&&
31>e&&(x=()=>jc("elysium"),f=16,h=16*(e+1),v(`-${Mb("elysium")}$`,y,B-14,16));h&&(t.strokeStyle="#a0a000",t.beginPath(),t.rect(16,f,h,64),t.stroke())}else if(10===this.mode){let l;h=f=0;mc()?(f=176,l="tartar",h=b):lc()?(f=96,l="asphodel",h=d):kc()&&(f=16,l="elysium",h=e);if(f){let n=~~((y-16)/16),m=~~((B-f)/16);const [p,z]=(N.g.u[l].map[m][n]??"").split("|");("f"===this.m&&3===m||"w"===this.m&&3!==m)&&"x"!==z&&"-"!==p&&n<h&&(t.strokeStyle="#a00000",t.beginPath(),t.rect(16+16*n,f+16*m,16,16),t.stroke(),
x=()=>{const E=N.g.u[l].map;var [U]=(E[m][n]??"").split("|");if(U===this.m){const ca=dc[this.J];if("f"===this.m){var D=Db[this.o];u("flr-i"+D.id+"-"+ca,20,150)}else D=Cb[this.o],u("wl-i"+D.id+"-"+ca,20,150);U=D.id;D=(ca===Y?D.N:Math.max(D.N,.1))*Eb[ca];N.g.C>=D&&(wa(),N.g.C-=D,E[m][n]=[this.m,U,dc[this.J]].join("|"),O(N))}})}}else if(20===this.mode){let l;h=f=0;let n=5;mc()?(f=176,n=0,l="tartar",h=b):lc()?(f=96,l="asphodel",h=d):kc()&&(f=16,n=0,l="elysium",h=e);if(f){let m=~~((y-16)/16);m<h&&m>=n&&
4!==m&&(t.strokeStyle="rgb(178,220,239)",t.beginPath(),t.rect(16+16*m,f,16,48),t.stroke(),v(`-${X[this.h].I}$`,y,B-14,16),x=()=>fc(this,m,l))}}else if(4===this.mode&&(b=0,mc()?(b=176,f="tartar"):lc()?(b=96,f="asphodel"):kc()&&(b=16,f="elysium"),b)){d=~~((y-16)/16);const l=N.g.u[f].G[d];l&&l.S&&(t.strokeStyle="#00a000",t.beginPath(),t.rect(16+16*d,b,16,48),t.stroke(),v(`-${l.V()}$`,y,B-14,16),x=()=>l.upgrade())}}}};class rc{constructor(a){this.g=0;this.start=new L("Start New Game",r/2,120,12,()=>{Lb();this.h();N.h=10});this.m=new L("Continue locally",r/2,170,12,()=>{Lb();N.ba();this.h();N.h=10});this.M=new L("Login with NEAR",r/2,220,12,async()=>{await lb();mb()&&(this.g=10)});this.B=new L("Continue with NEAR",r/2,220,12,()=>{this.g=10});this.l=new L("Sound ("+(K()?"On":"Off")+")",r/2,270,12,()=>{ua();this.l.text="Sound ("+(K()?"On":"Off")+")"});this.Z=new L("New Game",r/3-30,120,12,()=>{Lb();this.h();N.h=10;
this.g=0});this.Y=new L("Load Game from Near",r/3-30,180,12,async()=>{Lb();await ob();this.h();N.h=10;this.g=0});this.L=new L("Load locally saved",r/3-30,240,12,async()=>{Lb();N.ba();this.h();N.h=10});this.o=new L("Go Premium",2*r/3+30,120,12,async()=>{await rb();this.g=0});this.$=new L("Try other player base",2*r/3+30,180,12,async()=>{try{const b=prompt("Enter wallet ID to load:");if(b){const c=await nb(b);c?(Lb(),pb(c),this.h(),N.h=10,this.g=0):alert("No state found for "+b)}}catch(b){console.warn(b)}});
this.X=new L("Logout",2*r/3+30,240,12,()=>{try{gb?.signOut(),window.location.reload()}catch(b){console.warn(b)}});this.h=a;this.J=!!window.localStorage.getItem("hades_state")}j(){10===this.g?(ha(),v("Hades Defence",r/2,65,40,"#f0f0f0"),ib?(u("crown-c",r/2+30,110),v("Premium Tier",r/2+50,120,16,"#fff",!1)):this.o.j(),this.Z.j(),this.Y.j(),this.$.j(),this.L.j(),this.X.j()):(ha(),v("Hades Defence",r/2,65,40,"#f0f0f0"),this.l.j(),this.start.j(),this.J&&this.m.j(),mb()?this.B.j():this.M.j())}};const da=[{n:"bld",x:0,y:0},{n:"brd3",x:17,y:0},{n:"brd4",x:34,y:0},{n:"brick",x:51,y:0},{n:"ch-i0",x:68,y:0},{n:"ch-i1",x:85,y:0},{n:"crn1",x:102,y:0},{n:"crn4",x:119,y:0},{n:"crown",x:0,y:17},{n:"expnd",x:17,y:17},{n:"flame-i0",x:34,y:17},{n:"flame-i1",x:51,y:17},{n:"flame-i2",x:68,y:17},{n:"flame-i3",x:85,y:17},{n:"flame-i4",x:102,y:17},{n:"flame-i5",x:119,y:17},{n:"flr-i0",x:0,y:34},{n:"flr-i1",x:17,y:34},{n:"flr-i2",x:34,y:34},{n:"flr-i3",x:51,y:34},{n:"gate",x:68,y:34},{n:"grad",x:85,y:34},
{n:"hds-i0",x:102,y:34},{n:"hds-i1",x:119,y:34},{n:"hds-i2",x:0,y:51},{n:"hp",x:17,y:51},{n:"hpup",x:34,y:51},{n:"hr-i0",x:51,y:51},{n:"hr-i1",x:68,y:51},{n:"hr-i2",x:85,y:51},{n:"light-i0",x:102,y:51},{n:"light-i1",x:119,y:51},{n:"light-i2",x:0,y:68},{n:"lmp",x:17,y:68},{n:"m-i0",x:34,y:68},{n:"m-i1",x:51,y:68},{n:"m-i2",x:68,y:68},{n:"menu",x:85,y:68},{n:"money",x:102,y:68},{n:"ob-i0",x:119,y:68},{n:"ob-i1",x:0,y:85},{n:"ob-i2",x:17,y:85},{n:"pnt",x:34,y:85},{n:"sk-i0",x:51,y:85},{n:"sk-i1",x:68,
y:85},{n:"sk-i2",x:85,y:85},{n:"skull",x:102,y:85},{n:"soul",x:119,y:85},{n:"stones",x:0,y:102},{n:"up",x:17,y:102},{n:"water",x:34,y:102},{n:"wl-i0",x:51,y:102},{n:"wl-i1",x:68,y:102},{n:"wl-i2",x:85,y:102},{n:"wl-i3",x:102,y:102}];async function sc(){return aa()};function tc(){[["b","rgb(247,226,107)"],["p","rgb(190,38,51)"]].forEach(([a,b])=>{S("brd4",`brd2-${a}-i1`,b);T(`brd2-${a}-i1`,!0,0,`brd2-${a}-i7`);T(`brd2-${a}-i1`,!1,-Math.PI/2,`brd2-${a}-i3`);T(`brd2-${a}-i1`,!1,Math.PI/2,`brd2-${a}-i5`);[0,2,6,8].forEach(c=>{S("crn4",`brd2-${a}-i${c}`,b)});T(`brd2-${a}-i2`,!1,Math.PI/2,`brd2-${a}-i2`);T(`brd2-${a}-i2`,!1,Math.PI/2,`brd2-${a}-i8`);T(`brd2-${a}-i8`,!1,Math.PI/2,`brd2-${a}-i6`)});[0,2,6,8].forEach(a=>{S("crn1",`brd1-b-i${a}`,"rgb(247,226,107)","rgb(38,38,38)")});
S("brd3","brd1-b-i1","rgb(247,226,107)","rgb(38,38,38)");S("brd3","brd1-b-i7","rgb(247,226,107)","rgb(38,38,38)");T("brd1-b-i1",!1,Math.PI/2,"brd1-b-i3");T("brd1-b-i1",!1,-Math.PI/2,"brd1-b-i5")}function uc(){S("ch-i0","chA","rgb(142,168,185)",void 0,.5);S("ch-i1","chB","rgb(142,168,185)",void 0,.5);S("soul","soul-base","rgb(213,213,213)",void 0,.3);for(var a=0;3>a;a++)S("hr-i"+a,"hr-c-i"+a,"rgb(255,231,231)");for(a=0;3>a;a++)S("m-i"+a,"m-c-i"+a,"rgb(255,0,0)")}
function vc(){for(var a=0;3>a;a++)S(`light-i${a}`,`lgth-c-i${a}`,"rgb(247,226,107)",void 0,.15);for(a=0;6>a;a++)S(`flame-i${a}`,`flm-c-i${a}`,"rgb(190,38,51)");S("gate","gate-c","rgb(164,100,34)");S("water","water-c","rgb(0,87,132)","rgb(178,220,239)");Za("water-c","water-c");S("ob-i0","ob-i0-c","rgb(164,100,34)");S("ob-i1","ob-i1-c","rgb(100,67,58)");S("lmp","lmp-c","rgb(247,226,107)");S("hpup","hpup-c","rgb(142,168,185)");S("crown","crown-c","rgb(247,226,107)");S("money","money-c","rgb(247,226,107)");
S("hp","hp-c","rgb(190,38,51)");S("expnd","expnd-c","rgb(247,226,107)");S("pnt","pnt-c","rgb(255,52,69)");S("bld","bld-c","rgb(178,220,239)");S("up","up-c","rgb(93,253,0)");bb("soul","soul-paint");bb("sk-i1","sk-paint");bb("hds-i1","hds-paint")}
async function wc(){await sc();tc();uc();vc();S("stones","stones-d","rgb(86,86,86)");S("brick","brick-b","rgb(58,58,58)","rgb(86,86,86)");S("brick","brick-d","rgb(33,33,33)","rgb(86,86,86)");Za("stones-d","stones-grad");[[Y,"rgb(201,201,201)",.1],["d","rgb(164,100,34)",.2],["l","rgb(59,197,255)",.2],["h","rgb(255,52,69)",.2],["s","rgb(255,242,0)",.3],["g","rgb(93,253,0)",.2],["p","",.3]].forEach(([a,b,c])=>{for(let d=0;4>d;d++)"p"===a?Wa("wl-i"+d,"wl-i"+d+"-"+a,c):S("wl-i"+d,"wl-i"+d+"-"+a,b,void 0,
c)});[[Y,"rgb(107,107,107)"],["d","rgb(73,60,43)"],["l","rgb(49,162,242)"],["h","rgb(190,38,51)"],["s","rgb(247,226,107)"],["g","rgb(68,137,26)"],["p",""]].forEach(([a,b])=>{for(let c=0;4>c;c++){const d="flr-i"+c+"-"+a;"p"===a?Wa("flr-i"+c,d):S("flr-i"+c,d,b)}})};async function xc(){await wc();await jb();yc()}function yc(){function a(e){e/=1E3;const f=e-b;b=e;0===N.h?d.j():10===N.h&&c.j(f);requestAnimationFrame(a)}let b=0;ha();let c=new qc;const d=new rc(()=>{c=new qc});requestAnimationFrame(a)}document.addEventListener("DOMContentLoaded",()=>{setTimeout(xc,100)});</script></body></html>